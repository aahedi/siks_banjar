var versi="1",elem=document.createElement("div");elem.id="app",document.addEventListener("deviceready",onDeviceReady,!1);var domain="https://siks.dinsosp3a-banjarkota.id",key="SGVkaSBIZXJkaWFuYQ==";function onDeviceReady(){cek_gps()}function cek_gps(){cordova.plugins.diagnostic.isGpsLocationEnabled(function(e){"disabled"===(e?"enabled":"disabled")?(alert("aktifkan gps!"),cordova.plugins.diagnostic.switchToLocationSettings(),setTimeout(function(){cek_gps()},5e3)):lokasi()},function(e){alert("The following error occurred: "+e)})}function buka(e,a){e="/"+e+"/";var n=localStorage.getItem(e+a);if(null==n||0===n.length)if(navigator.onLine){var t=new XMLHttpRequest;t.onreadystatechange=function(){if(4!=t.readyState||200!=t.status)return t.responseText;document.body.innerHTML=t.responseText,hapus_atr("body","class"),window.localStorage.setItem(e+a,Base64.encode(t.responseText))};var o=new FormData;o.append("key","SGVkaSBIZXJkaWFuYQ=="),t.open("POST",domain+e+a,!0),t.send(o)}else mui_dialog("Tidak dapat terhubung, Periksa koneksi internet Anda!");else document.body.innerHTML=Base64.decode(n),hapus_atr("body","class")}function cari_nik(e,a,n){if(navigator.onLine){el("loading").style.display="block";var t=new XMLHttpRequest;t.open("GET",domain+"/android/act_get_nik.php?nik="+e,!0),t.onload=function(){if(t.status>=200&&t.status<400){el("loading").style.display="none";var e=t.responseText;if("0"==e.replace(/\s+/g,""))mui_dialog("Nik tidak terdaftar di Dinsos Banjar"),el(a).value="",null!=n&&(el(n).value="");else{var o=JSON.parse(e);el(a).value=o.nama,null!=n&&(el(n).value=o.alamat+", RT"+o.rt+"/RW"+o.rw+", Kel. "+o.kelurahan+", Kec. "+o.kecamatan)}}},t.onprogress=function(){el("loading").style.display="block"},t.onerror=function(){},t.send()}else mui_dialog("Tidak dapat terhubung, Periksa koneksi internet Anda!")}function mui_dialog(e,a,n=""){var t=";this.parentNode.parentNode.parentNode.removeChild(this.parentNode.parentNode);document.body.removeAttribute(&apos;class&apos;)",o=document.createElement("div");o.style.width="300px",o.style.height="150px",o.style.margin="auto",o.style.padding="15px",o.style.position="absolute",o.style.top="50%",o.style.left="50%",o.style.transform="translate(-50%, -50%)",o.style.backgroundColor="#fff",o.innerHTML+='<div class="mui-container"><div class="mui--text-title">'+n+'</div><br><div class="mui--text-body2">'+e+"</div></div>",o.innerHTML+='<button class="mui-btn mui-btn--flat mui-btn--primary" style="float:right" onclick='+a+t+"><strong>OK</strong></button>",null!=a&&0!==a&&(o.innerHTML+='<button class="mui-btn mui-btn--flat" style="float:right" onclick='+t+"><strong>Cancel</strong></button>"),mui.overlay("on",o)}function tgl(){var e=new Date;return e.getFullYear()+"-"+("00"+(e.getMonth()+1)).slice(-2)+"-"+("00"+e.getDate()).slice(-2)+" "+("00"+e.getHours()).slice(-2)+":"+("00"+e.getMinutes()).slice(-2)+":"+("00"+e.getSeconds()).slice(-2)}function el(e){return document.getElementById(e)}function els(e,a){return document.getElementsByClassName(e)[a]}function validasi(){return""==el("nik_pemohon").value||null==el("nik_pemohon")?(mui_dialog("NIK tidak boleh kosong"),el("nik_pemohon").focus(),!1):16!=el("nik_pemohon").value.length?(mui_dialog("NIK tidak valid"),el("nik_pemohon").focus(),!1):""==el("nama_pemohon").value||null==el("nama_pemohon")?(mui_dialog("Nama tidak boleh kosong"),el("nama_pemohon").focus(),!1):""==el("no_hp_pemohon").value||null==el("no_hp_pemohon")?(mui_dialog("No_HP tidak boleh kosong"),el("no_hp_pemohon").focus(),!1):""==el("nik_ajuan").value||null==el("nik_ajuan")?(mui_dialog("NIK tidak boleh kosong"),el("nik_ajuan").focus(),!1):16!=el("nik_ajuan").value.length?(mui_dialog("NIK tidak valid"),el("nik_ajuan").focus(),!1):""==el("nama_ajuan").value||null==el("nama_ajuan")?(mui_dialog("Nama tidak boleh kosong"),el("nama_ajuan").focus(),!1):""==el("alamat_ajuan").value||null==el("alamat_ajuan")?(mui_dialog("Alamat tidak boleh kosong"),el("alamat_ajuan").focus(),!1):""==el("ket_ajuan").value||null==el("ket_ajuan")?(mui_dialog("Keterangan tidak boleh kosong"),el("ket_ajuan").focus(),!1):""==el("lokasi").value||null==el("lokasi")?(mui_dialog("Kordinat Lokasi tidak boleh kosong"),el("lokasi").focus(),!1):""==el("foto_id").getAttribute("src")?(mui_dialog("Foto tidak boleh kosong"),el("foto_id").focus(),!1):void mui_dialog("Apakah Data Yang Dimasukkan Sudah Benar?","save_offline();")}function save_offline(){var e={tgl_ajuan:tgl(),nik_pemohon:el("nik_pemohon").value,nama_pemohon:el("nama_pemohon").value,no_hp_pemohon:el("no_hp_pemohon").value,nik_ajuan:el("nik_ajuan").value,nama_ajuan:el("nama_ajuan").value,alamat_ajuan:el("alamat_ajuan").value,ket_ajuan:el("ket_ajuan").value,lokasi:el("lokasi").value,foto_id:el("foto_id").getAttribute("src")};localStorage.setItem("data_form",JSON.stringify(e)),kirim()}function get_pemohon(){var e=localStorage.getItem("data_form");if(null!=e){var a=JSON.parse(e);el("nik_pemohon").value=a.nik_pemohon,el("nama_pemohon").value=a.nama_pemohon,el("no_hp_pemohon").value=a.no_hp_pemohon}else mui_dialog("Data Belum Ada")}function get_diajukan(){var e=localStorage.getItem("data_form");if(null!=e){var a=JSON.parse(e);el("alamat_ajuan").value=a.alamat_ajuan,el("ket_ajuan").value=a.ket_ajuan}else mui_dialog("Data Belum Ada")}function sample(){localStorage.setItem("data_form",JSON.stringify({tgl_ajuan:"2019-04-29 07:18:12",nik_pemohon:"1234567890123456",nama_pemohon:"Hedi Herdiana",no_hp_pemohon:"082240171199",nik_ajuan:"1234567890123456",nama_ajuan:"Siti Maria Holida",alamat_ajuan:"Perum Puri Sumelap Indah D62, Sumelap, Tamansari, Kota Tasikmalaya",ket_ajuan:"Izin mau jadi orang kaya raya"}))}function kirim(){if(navigator.onLine){el("loading").style.display="block";var e=new FormData;e.append("tgl_ajuan",tgl()),e.append("nik_pemohon",el("nik_pemohon").value),e.append("nama_pemohon",el("nama_pemohon").value),e.append("no_hp_pemohon",el("no_hp_pemohon").value),e.append("nik_ajuan",el("nik_ajuan").value),e.append("nama_ajuan",el("nama_ajuan").value),e.append("alamat_ajuan",el("alamat_ajuan").value),e.append("ket_ajuan",el("ket_ajuan").value),e.append("lokasi",el("lokasi").value),e.append("foto_id",el("foto_id").getAttribute("src")),client.open("POST",domain+"/android/act_ajuan.php?key="+key,!0),client.send(e)}else mui_dialog("Tidak dapat terhubung, Periksa koneksi internet Anda!")}buka("android","index.php");var client=new XMLHttpRequest;function clearID(){if(arguments.length>0)for(var e=0;e<arguments.length;e++)document.getElementById(arguments[e]).value=""}function hapus_atr(e,a){for(var n=document.querySelectorAll(e),t=0;t<n.length;t++)n[t].removeAttribute(a)}function update(){localStorage.clear(),location.reload()}function get_author(){return document.querySelector('meta[name="author"]').getAttribute("content")}function deleteFullLicense(e,a){var n=new XMLHttpRequest;n.onreadystatechange=function(){4==n.readyState&&204==n.status&&(row=document.getElementById(e),row.parentNode.removeChild(row))},n.open("POST","deleteLicense/"+a,!0),n.setRequestHeader("X-CSRFToken","{{ csrf_token }}"),n.send()}function izin(){for(var e=cordova.plugins.permissions,a=[e.CAMERA,e.ACCESS_COARSE_LOCATION,e.RECORD_AUDIO,e.WRITE_EXTERNAL_STORAGE],n=0;n<a.length;n++)e.requestPermission(a[n],o,t);function t(){izin()}function o(e){e.hasPermission||t()}}function lokasi(){navigator.geolocation.getCurrentPosition(function(e){var a='<svg xmlns="http://www.w3.org/2000/svg"><text  x="50%" y="50%" dominant-baseline="middle" font-size="20" font-family="Arial" fill="black"><tspan x="50%" text-anchor="middle">Searching location..</tspan><tspan x="50%" text-anchor="middle" dy="1.2em" fill="black">'+e.coords.latitude+","+e.coords.longitude+"</tspan></text></svg>",n=window.btoa(a);e.coords.accuracy>20?(el("gmap").src="",el("gmap").style.background="url(data:image/svg+xml;base64,"+n+")",lokasi()):(el("lokasi").value=e.coords.latitude+","+e.coords.longitude,el("kaca").innerHTML='<span style="bottom:0;position:absolute;background:#fff;padding:2px;">Accurate to: '+Math.floor(e.coords.accuracy)+" meter</span>",el("gmap").src="https://www.google.com/maps?q="+e.coords.latitude+","+e.coords.longitude+"&hl=id&z=15&output=embed",appendStyle(".gm-style .place-card-large {display: none;}"))},function(e){alert("GPS harus Aktif!"),lokasi()},{enableHighAccuracy:!0})}function initialize(e,a){Brussels=new google.maps.LatLng(e,a),myOptions={zoom:15,mapTypeId:google.maps.MapTypeId.ROADMAP,center:Brussels,streetViewControl:!1},map=new google.maps.Map(document.getElementById("googleMap"),myOptions),document.getElementById("koordinat_pickup").value=e+","+a,marker=new google.maps.Marker({position:Brussels,title:"Brussel, BE"}),marker.setMap(map),marker.setDraggable(!0),google.maps.event.addListener(marker,"dragend",function(e){var a=marker.getPosition();map.panTo(a),document.getElementById("latitude").value=a.lat(),document.getElementById("longitude").value=a.lng(),document.getElementById("koordinat_pickup").value=a.lat()+","+a.lng()}),google.maps.event.addListener(map,"click",function(e){var a=marker.getPosition();map.panTo(a),document.getElementById("latitude").value=a.lat(),document.getElementById("longitude").value=a.lng(),document.getElementById("koordinat_pickup").value=a.lat()+","+a.lng()})}function capturePhoto(){pictureSource=navigator.camera.PictureSourceType,destinationType=navigator.camera.DestinationType,navigator.camera.getPicture(onPhotoDataSuccess,onFail,{quality:50,destinationType:destinationType.DATA_URL})}function onPhotoDataSuccess(e){document.getElementById("foto_id").style.display="block",resizedataURL("data:image/jpeg;base64,"+e,"foto_id",640,640)}function onFail(e){alert("Failed because: "+e)}function resizedataURL(e,a,n,t){var o=document.createElement("img");o.onload=function(){var e=document.createElement("canvas"),l=e.getContext("2d"),i=n,u=t,s=o.width,r=o.height;s>r?s>i&&(r*=i/s,s=i):r>u&&(s*=u/r,r=u),e.width=s,e.height=r,l.drawImage(o,0,0,s,r);var d=e.toDataURL();document.getElementById(a).src=d},o.src=e}client.onreadystatechange=function(){if(4==client.readyState&&200==client.status){el("loading").style.display="none";var e=client.responseText;"1"==e.replace(/\s+/g,"")?(mui_dialog("Terimakasih data berhasil dikirim"),clearID("nik_pemohon","nama_pemohon","no_hp_pemohon","nik_ajuan","nama_ajuan","alamat_ajuan","ket_ajuan"),el("foto_id").src=""):"nik_ajuan"==e.replace(/\s+/g,"")?mui_dialog("Mohon maaf, <strong>"+el("nama_ajuan").value+" ("+el("nik_ajuan").value+")</strong> sudah di pernah diajukan oleh orang lain."):mui_dialog("Mohon maaf, terjadi kesalahan sistem, silahkan coba beberapa saat lagi.")}},appendStyle=function(e){style=document.createElement("style"),style.type="text/css",style.appendChild(document.createTextNode(e)),document.head.appendChild(style)};
